# 使用子查询

- 查询：任何SQL语句都是查询。但此术语一般指SELECT语句
- 利用子查询进行过滤：列出订购物品TNT2的所有客户，应该怎样检索？
  - (1) 检索包含物品TNT2的所有订单的编号
  - (2) 检索具有前一步骤列出的订单编号的所有客户的ID。
  - (3) 检索前一步骤返回的所有客户ID的客户信息、
  - `SELECT order_num FROM oderitems WHERE prod_id = 'TNT2'`
  - `SELET cust_id FROM orders WHERE order_num IN (20005, 20007)`
  - `SELECT cust_id FROM orders WHERE order_num IN( SELECT order_num FROM orderitems WHERE prod_id = 'TNT2')`
  - `SELECT cust_name, cust_contact FROM customers WHERE cust_id IN(10001, 10004)`
  - `SELECT cust_name, cust_contact FROM customers WHERE cust_id IN (SELECT cust_id FROM order_num IN (SELECT oder_num FROM order items WHERE prod_id = 'TNT2'))`
- 列必须匹配：在WHERE子句中使用子查询(如这里所示)，应该保证SELECT语句具有与WHERE子句中相同数目的列。
- 子查询和性能：这里给出的代码有效并获得所需的结果。更多的论述，请参阅15张。
- 作为计算字段使用子查询
  - (1) 从customers表中检索客户列表。
  - (2) 对于检索出的每个客户， 统计其在orders表中的订单数目。
  - `SELECT COUNT(*) AS orders FROM orders WHERE cust_id = 10001;`
  - `SELECT cust_name, cust_state, (SELECT COUNT(*) FROM orders WHERE orders.cust_id = customoers.cust_id) AS orders  FROM customers ORDER BY cust_name`
- 相关子查询：涉及外部查询的子查询
  - 不使用完全限定的列名：
    - `SELECT cust_name, cust_state, (SELECT COUNT(*) FROM orders WHERE cust_id = cust_id) AS orders FROM customers ORDER BY cust_name`